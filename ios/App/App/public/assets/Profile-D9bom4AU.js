var M=Object.defineProperty;var Y=(s,a,n)=>a in s?M(s,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[a]=n;var I=(s,a,n)=>Y(s,typeof a!="symbol"?a+"":a,n);import{p as V,s as j,af as q,u as _,ag as P,r as p,j as e,C as v,f as y,c as b,d as C,ah as z,ai as $,aj as K,ak as L,al as B,B as U,w as S,I as T,M as D,X as O,am as G,an as H,S as W,x as J,y as X,z as Q,A as Z,q as E}from"./index-Caw7KGCA.js";import{S as ee}from"./settings-CUAoXI7l.js";import{U as se}from"./user-Bk-1Xv9-.js";import{U as k}from"./users-Bala6d7Y.js";import{u as ae,a as te,C as re}from"./useFollowActions-Xl1zwE1B.js";import"./UserProfileActions-ChRHtiKK.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=V("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);class R{static async checkBucketAccess(){try{const{error:a}=await j.storage.from(this.AVATARS_BUCKET).list("",{limit:1});return!a}catch(a){return console.error("Storage bucket access check failed:",a),!1}}static async uploadAvatar(a,n){try{if(!await this.checkBucketAccess())return console.warn("Avatar storage bucket not accessible, using fallback"),null;if(!["image/jpeg","image/png","image/webp","image/gif"].includes(n.type))throw new Error("Invalid file type. Please upload a JPEG, PNG, WebP, or GIF image.");if(n.size>5242880)throw new Error("File size too large. Please upload an image smaller than 5MB.");const h=n.name.split(".").pop(),o=`${a}/${q()}.${h}`;console.log(`Uploading avatar for user ${a}: ${o}`);const{error:i}=await j.storage.from(this.AVATARS_BUCKET).upload(o,n,{cacheControl:"3600",upsert:!0});if(i)throw console.error("Error uploading avatar:",i),new Error(`Failed to upload avatar: ${i.message}`);const{data:d}=j.storage.from(this.AVATARS_BUCKET).getPublicUrl(o);return console.log("Avatar uploaded successfully:",d.publicUrl),d.publicUrl}catch(r){throw console.error("Error in uploadAvatar:",r),r instanceof Error?r:new Error("Failed to upload avatar")}}static async deleteAvatar(a){try{if(!await this.checkBucketAccess())return console.warn("Avatar storage bucket not accessible"),!1;const m=new URL(a).pathname.split("/"),h=m.findIndex(d=>d===this.AVATARS_BUCKET);if(h===-1)return console.error("Invalid avatar URL format"),!1;const o=m.slice(h+1).join("/");console.log(`Deleting avatar: ${o}`);const{error:i}=await j.storage.from(this.AVATARS_BUCKET).remove([o]);return i?(console.error("Error deleting avatar:",i),!1):!0}catch(n){return console.error("Error in deleteAvatar:",n),!1}}}I(R,"AVATARS_BUCKET","avatars");const ie=()=>{var l,u;const{user:s,signOut:a,updateUserAvatar:n,refreshUser:r}=_(),{toast:m}=P(),[h,o]=p.useState(!1),i=p.useRef(null);if(!s)return e.jsx(v,{children:e.jsx(y,{className:"p-3 md:p-6",children:e.jsx("div",{className:"flex items-center justify-center py-4 md:py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 md:h-8 md:w-8 border-b-2 border-chichi-purple"})})})});const d=async f=>{var t;const N=(t=f.target.files)==null?void 0:t[0];if(!N||!(s!=null&&s.id)){console.log("No file selected or user not authenticated");return}if(!N.type.startsWith("image/")){m({title:"Invalid File",description:"Please select an image file.",variant:"destructive"});return}if(N.size>5*1024*1024){m({title:"File Too Large",description:"Please select an image smaller than 5MB.",variant:"destructive"});return}o(!0);try{console.log("Uploading avatar for user:",s.id);const c=await R.uploadAvatar(s.id,N);if(c&&n)console.log("Avatar uploaded, updating user profile with URL:",c),await n(c),r&&await r(),m({title:"Avatar Updated",description:"Your profile picture has been updated successfully!"});else throw new Error("Failed to upload avatar or update function not available")}catch(c){console.error("Error updating avatar:",c),m({title:"Update Failed",description:c instanceof Error?c.message:"Failed to update profile picture.",variant:"destructive"})}finally{o(!1),i.current&&(i.current.value="")}},g=()=>{var f;(f=i.current)==null||f.click()};return e.jsxs(v,{children:[e.jsx(b,{className:"pb-2 md:pb-3",children:e.jsxs(C,{className:"flex items-center gap-2 text-lg md:text-xl text-white",children:[e.jsx(ee,{className:"h-4 w-4 md:h-5 md:w-5"}),"Profile Settings"]})}),e.jsxs(y,{className:"space-y-4 md:space-y-6 p-3 md:p-6",children:[e.jsxs("div",{className:"space-y-3 md:space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 md:gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(z,{className:"h-16 w-16 md:h-20 md:w-20 cursor-pointer",onClick:g,children:[e.jsx($,{src:(s==null?void 0:s.avatarUrl)||"",alt:(s==null?void 0:s.username)||(s==null?void 0:s.name)||"User"}),e.jsx(K,{className:"text-base md:text-lg",children:((u=(l=(s==null?void 0:s.username)||(s==null?void 0:s.name))==null?void 0:l[0])==null?void 0:u.toUpperCase())||"U"})]}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-full flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity cursor-pointer",onClick:g,children:e.jsx(L,{className:"h-5 w-5 md:h-6 md:w-6 text-white"})}),h&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-70 rounded-full flex items-center justify-center",children:e.jsx(B,{className:"h-5 w-5 md:h-6 md:w-6 text-white animate-spin"})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-sm md:text-base",children:(s==null?void 0:s.username)||(s==null?void 0:s.name)||"User"}),e.jsx("p",{className:"text-xs md:text-sm text-gray-600",children:s==null?void 0:s.email}),e.jsx(U,{variant:"outline",size:"sm",className:"mt-2 text-xs md:text-sm h-7 md:h-8",onClick:g,disabled:h,children:h?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"h-3 w-3 md:h-4 md:w-4 mr-1 animate-spin"}),e.jsx("span",{className:"hidden sm:inline",children:"Uploading..."}),e.jsx("span",{className:"sm:hidden",children:"..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"h-3 w-3 md:h-4 md:w-4 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Change Photo"}),e.jsx("span",{className:"sm:hidden",children:"Photo"})]})})]})]}),e.jsx("input",{ref:i,type:"file",accept:"image/*",onChange:d,className:"hidden"}),e.jsx("p",{className:"text-xs md:text-sm text-gray-600",children:'Click on your avatar or the "Change Photo" button to upload a new profile picture. Maximum size: 5MB.'})]}),e.jsx("div",{className:"space-y-3 md:space-y-4",children:e.jsxs("div",{className:"space-y-1 md:space-y-2",children:[e.jsx(S,{htmlFor:"email",className:"text-sm",children:"Email Address"}),e.jsx(T,{id:"email",value:(s==null?void 0:s.email)||"",readOnly:!0,className:"bg-gray-50 text-sm h-8 md:h-10"}),e.jsx("p",{className:"text-xs md:text-sm text-gray-600",children:"Email address cannot be changed"})]})}),e.jsx("div",{className:"pt-3 md:pt-4 border-t",children:e.jsx(U,{variant:"outline",onClick:a,className:"w-full text-sm h-8 md:h-10",children:"Sign Out"})})]})]})},ce=()=>{const{user:s,refreshUser:a}=_(),{toast:n}=P(),[r,m]=p.useState((s==null?void 0:s.username)||""),[h,o]=p.useState(!1),[i,d]=p.useState(!1),[g,l]=p.useState(null),u=async x=>{if(!x||x.length<3){l(null);return}d(!0);try{const{data:w,error:A}=await j.from("user_profiles").select("id").eq("username",x.toLowerCase()).neq("id",s==null?void 0:s.id).maybeSingle();if(A)throw console.error("Error checking username:",A),A;l(!w)}catch(w){console.error("Error checking username:",w),l(null)}finally{d(!1)}},f=x=>{const w=x.toLowerCase().replace(/[^a-z0-9_]/g,"");m(w),l(null);const A=setTimeout(()=>{w&&w!==(s==null?void 0:s.username)&&u(w)},500);return()=>clearTimeout(A)},N=async()=>{if(!r||r.length<3){n({title:"Invalid Username",description:"Username must be at least 3 characters long.",variant:"destructive"});return}if(g===!1){n({title:"Username Taken",description:"This username is already taken. Please choose another.",variant:"destructive"});return}if(r===(s==null?void 0:s.username)){n({title:"No Changes",description:"Username is already set to this value."});return}o(!0);try{console.log("Updating username to:",r);const{error:x}=await j.from("user_profiles").update({username:r.toLowerCase()}).eq("id",s==null?void 0:s.id);if(x)throw console.error("Supabase error updating username:",x),x;console.log("Username updated successfully in database"),await a(),n({title:"Username Updated",description:"Your username has been successfully updated!"})}catch(x){console.error("Error updating username:",x),n({title:"Error",description:x instanceof Error?x.message:"Failed to update username. Please try again.",variant:"destructive"})}finally{o(!1)}},c=!r||r.length<3||r===(s==null?void 0:s.username)?null:i?{icon:null,text:"Checking...",color:"text-gray-500"}:g===!0?{icon:D,text:"Available",color:"text-green-600"}:g===!1?{icon:O,text:"Taken",color:"text-red-600"}:null,F=r===(s==null?void 0:s.username);return e.jsxs(v,{children:[e.jsx(b,{className:"pb-2 md:pb-3",children:e.jsxs(C,{className:"flex items-center gap-2 text-lg md:text-xl",children:[e.jsx(se,{className:"h-4 w-4 md:h-5 md:w-5"}),"Username"]})}),e.jsxs(y,{className:"space-y-3 md:space-y-4 p-3 md:p-6",children:[e.jsxs("div",{className:"space-y-1 md:space-y-2",children:[e.jsx(S,{htmlFor:"username",className:"text-sm",children:"Username"}),e.jsxs("div",{className:"relative",children:[e.jsx(T,{id:"username",value:r,onChange:x=>f(x.target.value),placeholder:"Enter your username",className:"pr-16 md:pr-20 text-sm h-8 md:h-10"}),c&&e.jsxs("div",{className:`absolute right-2 md:right-3 top-1/2 -translate-y-1/2 flex items-center gap-1 text-xs md:text-sm ${c.color}`,children:[c.icon&&e.jsx(c.icon,{className:"h-3 w-3 md:h-4 md:w-4"}),e.jsx("span",{className:"hidden sm:inline",children:c.text})]})]}),e.jsx("p",{className:"text-xs md:text-sm text-gray-600",children:"This will be your display name and how other users find you. Only letters, numbers, and underscores allowed."}),(s==null?void 0:s.username)&&e.jsxs("p",{className:"text-xs md:text-sm text-blue-600",children:["Current username: @",s.username]})]}),e.jsx(U,{onClick:N,disabled:h||!r||r.length<3||g===!1||F,className:"w-full text-sm h-8 md:h-10",children:h?"Saving...":F?"Username Saved":"Save Username"})]})]})},le=()=>{const{user:s}=_(),{toast:a}=P(),[n,r]=p.useState(!1),[m,h]=p.useState(!0),[o,i]=p.useState(!1);p.useEffect(()=>{s!=null&&s.id&&d()},[s==null?void 0:s.id]);const d=async()=>{try{const{data:l,error:u}=await j.from("user_privacy_settings").select("share_progress_on_creator_connect").eq("user_id",s==null?void 0:s.id).maybeSingle();if(u&&u.code!=="PGRST116"){console.error("Error fetching privacy settings:",u);return}r(l?!l.share_progress_on_creator_connect:!1)}catch(l){console.error("Error fetching privacy settings:",l)}finally{h(!1)}},g=async l=>{if(s!=null&&s.id){i(!0);try{const u=!l,{error:f}=await j.from("user_privacy_settings").upsert({user_id:s.id,share_progress_on_creator_connect:u,updated_at:new Date().toISOString()},{onConflict:"user_id"});if(f){console.error("Error updating privacy settings:",f),a({title:"Error",description:"Failed to update privacy settings. Please try again.",variant:"destructive"});return}r(l),a({title:"Settings Updated",description:l?"Your profile has been hidden from Creator Connect.":"Your progress is now visible on Creator Connect!"})}catch(u){console.error("Error updating privacy settings:",u),a({title:"Error",description:"Failed to update privacy settings. Please try again.",variant:"destructive"})}finally{i(!1)}}};return m?e.jsxs(v,{children:[e.jsx(b,{className:"pb-2 md:pb-3",children:e.jsxs(C,{className:"flex items-center gap-2 text-lg md:text-xl",children:[e.jsx(k,{className:"h-4 w-4 md:h-5 md:w-5"}),"Creator Connect"]})}),e.jsx(y,{className:"p-3 md:p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-3 md:h-4 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 md:h-4 bg-gray-200 rounded w-1/2"})]})})]}):e.jsxs(v,{children:[e.jsx(b,{className:"pb-2 md:pb-3",children:e.jsxs(C,{className:"flex items-center gap-2 text-lg md:text-xl",children:[e.jsx(k,{className:"h-4 w-4 md:h-5 md:w-5"}),"Creator Connect"]})}),e.jsxs(y,{className:"space-y-3 md:space-y-4 p-3 md:p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{id:"stop-sharing",checked:n,onCheckedChange:g,disabled:o}),e.jsxs(S,{htmlFor:"stop-sharing",className:"flex items-center gap-2 text-sm",children:[e.jsx(ne,{className:"h-3 w-3 md:h-4 md:w-4"}),"Stop sharing my progress on Creator Connect"]})]}),e.jsxs("div",{className:"text-xs md:text-sm text-gray-600",children:[e.jsx("p",{className:"mb-2",children:n?"Your profile is currently hidden from other creators.":"Other creators can discover your profile and see:"}),!n&&e.jsxs("ul",{className:"list-disc list-inside space-y-0.5 text-xs",children:[e.jsx("li",{children:"Your current streak and total points"}),e.jsx("li",{children:"Your level and achievements"}),e.jsx("li",{children:"When you joined CHICHI"})]}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"You can change this setting anytime."})]})]})]})},oe=["Beauty","Fashion","Wellness","Tech","Education","Lifestyle","Finance","Fitness","Music","Art & Design","Food & Recipes","Creator Education","Motivation & Mindset","Parenting","Business Owner","Other"];function de(){const{user:s}=_(),[a,n]=p.useState([]),[r,m]=p.useState(""),[h,o]=p.useState(!0),[i,d]=p.useState(!1);p.useEffect(()=>{g()},[s==null?void 0:s.id]);const g=async()=>{if(s!=null&&s.id)try{const{data:t,error:c}=await j.from("user_profiles").select("niche_preferences").eq("id",s.id).single();if(c)throw c;n((t==null?void 0:t.niche_preferences)||[])}catch(t){console.error("Error fetching niche preferences:",t)}finally{o(!1)}},l=t=>{if(a.length>=2){E({title:"Maximum reached",description:"You can only select up to 2 niches",variant:"destructive"});return}if(a.includes(t)){E({title:"Already selected",description:"This niche is already in your list",variant:"destructive"});return}n([...a,t])},u=()=>{r.trim()&&(l(r.trim()),m(""))},f=t=>{n(a.filter(c=>c!==t))},N=async()=>{if(s!=null&&s.id){d(!0);try{const{error:t}=await j.from("user_profiles").update({niche_preferences:a}).eq("id",s.id);if(t)throw t;E({title:"Preferences saved",description:"Your niche preferences have been updated successfully"})}catch(t){console.error("Error saving niche preferences:",t),E({title:"Error",description:"Failed to save niche preferences. Please try again.",variant:"destructive"})}finally{d(!1)}}};return h?e.jsxs(v,{children:[e.jsx(b,{children:e.jsx(C,{children:"Your Niche"})}),e.jsx(y,{children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-4"}),e.jsx("div",{className:"h-10 bg-gray-200 rounded mb-4"})]})})]}):e.jsxs(v,{children:[e.jsxs(b,{children:[e.jsx(C,{children:"Your Niche"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Select up to 2 content niches that best describe your content focus"})]}),e.jsxs(y,{className:"space-y-4",children:[a.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(S,{children:["Selected Niches (",a.length,"/2)"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:a.map((t,c)=>e.jsxs(H,{variant:"secondary",className:"flex items-center gap-1",children:[t,e.jsx(O,{className:"h-3 w-3 cursor-pointer hover:text-red-500",onClick:()=>f(t)})]},c))})]}),a.length<2&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{children:"Add a Niche"}),e.jsxs(W,{onValueChange:t=>{t!=="Other"&&l(t)},children:[e.jsx(J,{children:e.jsx(X,{placeholder:"Select a niche..."})}),e.jsx(Q,{className:"bg-white border border-gray-200 shadow-lg z-50",children:oe.filter(t=>!a.includes(t)).map(t=>e.jsx(Z,{value:t,children:t},t))})]})]}),a.length<2&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{children:"Or add a custom niche"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(T,{placeholder:"Enter custom niche...",value:r,onChange:t=>m(t.target.value),onKeyPress:t=>{t.key==="Enter"&&u()}}),e.jsx(U,{type:"button",onClick:u,disabled:!r.trim(),variant:"outline",children:"Add"})]})]}),e.jsx(U,{onClick:N,disabled:i,className:"w-full",children:i?"Saving...":"Save Preferences"})]})]})}function me(){const{creators:s,setCreators:a,isLoading:n}=ae(),{followingStatus:r,pendingRequests:m,followingActions:h,handleFollow:o,handleUnfollow:i}=te(s,a),d=s.filter(g=>r[g.id]);return n?e.jsxs(v,{children:[e.jsx(b,{className:"pb-2 md:pb-3",children:e.jsxs(C,{className:"flex items-center gap-2 text-lg md:text-xl",children:[e.jsx(k,{className:"h-4 w-4 md:h-5 md:w-5"}),"Connected Creators"]})}),e.jsx(y,{className:"p-3 md:p-6",children:e.jsxs("div",{className:"text-center py-4 md:py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 md:h-8 md:w-8 border-b-2 border-chichi-orange mx-auto"}),e.jsx("p",{className:"mt-2 md:mt-4 text-gray-600 text-sm",children:"Loading connected creators..."})]})})]}):e.jsxs(v,{children:[e.jsx(b,{className:"pb-2 md:pb-3",children:e.jsxs(C,{className:"flex items-center gap-2 text-lg md:text-xl",children:[e.jsx(k,{className:"h-4 w-4 md:h-5 md:w-5"}),"Connected Creators (",d.length,")"]})}),e.jsx(y,{className:"p-3 md:p-6",children:d.length===0?e.jsxs("div",{className:"text-center py-4 md:py-8",children:[e.jsx("div",{className:"text-2xl md:text-4xl mb-2 md:mb-4",children:"🤝"}),e.jsx("p",{className:"text-gray-600 mb-1 md:mb-2 text-sm",children:"No connections yet"}),e.jsx("p",{className:"text-xs md:text-sm text-gray-500",children:"Visit Creator Connect to discover and connect with other creators!"})]}):e.jsx(re,{creators:d,followingStatus:r,pendingRequests:m,followingActions:h,onFollow:o,onUnfollow:i})})]})}function ve(){return e.jsxs("div",{className:"max-w-4xl mx-auto p-2 md:p-6 pb-20 md:pb-6",children:[e.jsx("h1",{className:"text-xl md:text-3xl font-bold mb-4 md:mb-8 px-1 md:px-0",children:"Profile Settings"}),e.jsxs("div",{className:"space-y-3 md:space-y-6",children:[e.jsx(ie,{}),e.jsx(ce,{}),e.jsx(de,{}),e.jsx(le,{}),e.jsx(me,{})]})]})}export{ve as default};
