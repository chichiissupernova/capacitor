import{R as V,u as F,r as m,j as e,I as f,B as b,L as T,a as z,b as H,E as B,C as $,c as M,d as O,e as U,f as X,g as Y,D as G,h as J,i as K,k as Q,l as W}from"./index-Caw7KGCA.js";import{u as P,F as L,a as C,b as y,c as S,d as v,e as N}from"./form-CcKQMLHU.js";import{z as j,v as k,C as q,t as E}from"./passwordValidator-GZWggTWZ.js";import{A as I,a as D}from"./alert-D_V2V2Ts.js";const A=j.string().trim().email({message:"Please enter a valid email address"}),Z=j.string().min(1,"Password is required").refine(r=>k(r).isValid,{message:"Password doesn't meet security requirements"}),_=j.object({email:A,password:j.string().min(1,"Password is required")}),ee=j.object({email:A,password:Z,confirmPassword:j.string().min(1,"Please confirm your password")}).refine(r=>r.password===r.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]}),R=V.memo(({onSuccess:r})=>{const{login:h,error:u,clearError:d,isLoading:p}=F(),[x,i]=m.useState(!1),[l,t]=m.useState(null),a=P({resolver:E(_),defaultValues:{email:"",password:""}}),c=x||p,s=m.useCallback(async n=>{console.log("LoginForm: Form submission started"),d&&d(),t(null),i(!0);try{console.log("LoginForm: Attempting login for:",{email:n.email}),await h(n.email,n.password),console.log("LoginForm: Login successful, calling onSuccess immediately"),i(!1),r&&r()}catch(w){console.error("LoginForm: Login failed with error:",w),t(w.message||"Login failed. Please try again."),i(!1)}},[h,d,r]),o=u||(l?new Error(l):null);return e.jsx(L,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(s),className:"space-y-4","aria-label":"Login form",children:[o&&e.jsxs(I,{variant:"destructive",className:"mb-4",role:"alert",children:[e.jsx(q,{className:"h-4 w-4 mr-2","aria-hidden":"true"}),e.jsx(D,{children:o.message})]}),e.jsx(C,{control:a.control,name:"email",render:({field:n})=>e.jsxs(y,{children:[e.jsx(S,{children:"Email"}),e.jsx(v,{children:e.jsx(f,{placeholder:"you@example.com",...n,type:"email","aria-required":"true",autoComplete:"email",disabled:c})}),e.jsx(N,{role:"alert"})]})}),e.jsx(C,{control:a.control,name:"password",render:({field:n})=>e.jsxs(y,{children:[e.jsx(S,{children:"Password"}),e.jsx(v,{children:e.jsx(f,{type:"password",placeholder:"••••••••",...n,"aria-required":"true",autoComplete:"current-password",disabled:c})}),e.jsx(N,{role:"alert"})]})}),e.jsx(b,{type:"submit",className:"w-full bg-chichi-orange hover:bg-chichi-orange/90",disabled:c,"aria-busy":c,children:c?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{size:"sm"}),"Signing in..."]}):"Sign In"})]})})});R.displayName="LoginForm";const se=({onSuccess:r})=>{const{signup:h,error:u,clearError:d}=F(),[p,x]=m.useState(!1),[i,l]=m.useState({isValid:!0,errors:[]}),t=P({resolver:E(ee),defaultValues:{email:"",password:"",confirmPassword:""},mode:"onChange"}),a=s=>{const o=k(s.target.value);l(o),t.setValue("password",s.target.value)},c=async s=>{d(),x(!0);try{console.log("Signup form submission:",{email:s.email}),await h(s.email,s.password)}catch(o){console.error("Form submission error:",o)}finally{x(!1)}};return e.jsx(L,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(c),className:"space-y-4","aria-label":"Signup form",children:[u&&e.jsxs(I,{variant:"destructive",className:"mb-4",role:"alert",children:[e.jsx(q,{className:"h-4 w-4 mr-2","aria-hidden":"true"}),e.jsx(D,{children:u.message})]}),e.jsx(C,{control:t.control,name:"email",render:({field:s})=>e.jsxs(y,{children:[e.jsx(S,{children:"Email"}),e.jsx(v,{children:e.jsx(f,{placeholder:"you@example.com",...s,onChange:o=>s.onChange(o.target.value.trim()),type:"email","aria-required":"true",autoComplete:"email"})}),e.jsx(N,{role:"alert"})]})}),e.jsx(C,{control:t.control,name:"password",render:({field:s})=>e.jsxs(y,{children:[e.jsx(S,{children:"Password"}),e.jsx(v,{children:e.jsx(f,{type:"password",placeholder:"••••••••",...s,onChange:a,"aria-required":"true",autoComplete:"new-password","aria-describedby":"password-requirements"})}),!i.isValid&&i.errors.length>0&&e.jsx("div",{className:"text-xs text-amber-600 mt-1",id:"password-requirements",role:"alert",children:e.jsx("ul",{className:"list-disc pl-4",children:i.errors.map((o,n)=>e.jsx("li",{children:o},n))})}),e.jsx(N,{role:"alert"})]})}),e.jsx(C,{control:t.control,name:"confirmPassword",render:({field:s})=>e.jsxs(y,{children:[e.jsx(S,{children:"Confirm Password"}),e.jsx(v,{children:e.jsx(f,{type:"password",placeholder:"••••••••",...s,"aria-required":"true",autoComplete:"new-password"})}),e.jsx(N,{role:"alert"})]})}),e.jsx(b,{type:"submit",className:"w-full bg-chichi-orange hover:bg-chichi-orange/90",disabled:p,"aria-busy":p,children:p?"Creating account...":"Create Account"})]})})},re=()=>e.jsxs("div",{className:"text-sm text-muted-foreground mt-2",id:"password-requirements-list",children:[e.jsx("p",{className:"font-medium mb-1",children:"Password requirements:"}),e.jsxs("ul",{className:"list-disc pl-5 space-y-1",role:"list",children:[e.jsx("li",{children:"At least 8 characters long"}),e.jsx("li",{children:"Contain uppercase and lowercase letters"}),e.jsx("li",{children:"Contain at least one number"}),e.jsx("li",{children:"Contain at least one special character"})]})]}),le=()=>{var n,w;const[r,h]=m.useState(!0),{isAuthenticated:u,isLoading:d,error:p}=F(),[x,i]=m.useState(!1),l=z(),a=((w=(n=H().state)==null?void 0:n.from)==null?void 0:w.pathname)||"/dashboard";m.useEffect(()=>{if(!d&&u){console.log("User is authenticated, checking for pending challenge");const g=localStorage.getItem("pendingInviteToken");g?(console.log("Found pending invite token, redirecting to join flow"),l(`/challenge/join?token=${g}`,{replace:!0})):(console.log("No pending challenge, redirecting to:",a),l(a,{replace:!0}))}},[u,l,a,d]);const c=()=>{h(!r),r||i(!1)},s=()=>{console.log("Auth success, checking for pending challenge");const g=localStorage.getItem("pendingInviteToken");g?(console.log("Found pending invite token, redirecting to join flow"),l(`/challenge/join?token=${g}`,{replace:!0})):(console.log("No pending challenge, redirecting to:",a),l(a,{replace:!0}))},o=g=>{g.preventDefault(),console.log("Navigating to forgot password page"),l("/reset-password")};return e.jsx(B,{children:e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4",style:{backgroundImage:"url('/lovable-uploads/9c2ae659-f23f-4a85-b2ea-3346c40fcbf2.png')",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},role:"main","aria-labelledby":"login-heading",children:[e.jsxs($,{className:"w-full max-w-md shadow-lg",children:[e.jsxs(M,{className:"space-y-1 text-center px-4 sm:px-6",children:[e.jsx(O,{id:"login-heading",className:"text-2xl sm:text-3xl font-bold",children:e.jsx("span",{className:"text-chichi-orange",children:"CHICHI"})}),e.jsx(U,{children:r?"Sign in to your account":"Create your account"})]}),e.jsx(X,{className:"px-4 sm:px-6",children:r?e.jsx(R,{onSuccess:s}):e.jsxs(e.Fragment,{children:[e.jsx(se,{onSuccess:s}),e.jsx("div",{className:"mt-4",children:e.jsx(b,{variant:"outline",size:"sm",onClick:()=>i(!0),className:"text-xs","aria-label":"View password requirements",children:"View password requirements"})})]})}),e.jsxs(Y,{className:"flex flex-col space-y-4 px-4 sm:px-6",children:[r&&e.jsx(b,{variant:"link",className:"text-sm sm:text-base text-chichi-purple",onClick:o,"aria-label":"Forgot password",children:"Forgot password?"}),e.jsx(b,{variant:"link",onClick:c,className:"w-full text-sm sm:text-base","aria-label":r?"Switch to signup form":"Switch to login form",children:r?"Don't have an account? Sign up":"Already have an account? Log in"})]})]}),e.jsx(G,{open:x,onOpenChange:i,children:e.jsxs(J,{className:"sm:max-w-md",role:"dialog","aria-label":"Password requirements",children:[e.jsxs(K,{children:[e.jsx(Q,{children:"Password Requirements"}),e.jsx(W,{children:"Your password must meet the following requirements:"})]}),e.jsx(re,{})]})})]})})};export{le as default};
