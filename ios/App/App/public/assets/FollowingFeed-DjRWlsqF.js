import{p as H,ag as U,r as x,s as f,j as e,C as h,f as u,ah as y,ai as b,aj as k,aN as M,aA as g,ao as Y,a as F,c as C,d as A,B as L,u as S}from"./index-Caw7KGCA.js";import{U as E}from"./users-Bala6d7Y.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v=H("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);function B(s){U();const[a,t]=x.useState([]),[r,n]=x.useState([]),[c,p]=x.useState(!0),T=async()=>{if(s)try{const{data:l,error:i}=await f.from("user_follows").select(`
          following_id,
          user_profiles!user_follows_following_id_fkey (
            id,
            name,
            username,
            avatar_url,
            current_streak,
            points,
            level
          )
        `).eq("follower_id",s);if(i){console.error("Error fetching followed creators:",i);return}const m=(l==null?void 0:l.map(d=>d.user_profiles).filter(Boolean))||[];n(m)}catch(l){console.error("Error fetching followed creators:",l)}},$=async()=>{if(s)try{const{data:l,error:i}=await f.from("user_follows").select("following_id").eq("follower_id",s);if(i){console.error("Error fetching following list:",i);return}const m=(l==null?void 0:l.map(o=>o.following_id))||[];if(m.length===0){p(!1);return}const{data:d,error:j}=await f.from("task_completions").select(`
          id,
          user_id,
          task_name,
          points_earned,
          completed_at,
          user_profiles!task_completions_user_id_fkey (
            name,
            username,
            avatar_url
          )
        `).in("user_id",m).order("completed_at",{ascending:!1}).limit(20);if(j){console.error("Error fetching activities:",j);return}const D=(d==null?void 0:d.map(o=>{var _,w,N;return{id:o.id,user_id:o.user_id,user_name:((_=o.user_profiles)==null?void 0:_.name)||"Anonymous",user_username:((w=o.user_profiles)==null?void 0:w.username)||"",user_avatar:((N=o.user_profiles)==null?void 0:N.avatar_url)||"",activity_type:"task_completion",activity_data:{task_name:o.task_name,points_earned:o.points_earned},created_at:o.completed_at}}))||[];t(D)}catch(l){console.error("Error fetching following feed:",l)}finally{p(!1)}};return x.useEffect(()=>{s&&($(),T())},[s]),{feedActivities:a,followedCreators:r,isLoading:c}}const q=s=>{const a=new Date(s),r=Math.floor((new Date().getTime()-a.getTime())/(1e3*60*60));if(r<1)return"Just now";if(r<24)return`${r}h ago`;const n=Math.floor(r/24);return n<7?`${n}d ago`:a.toLocaleDateString()};function z(){return e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Following Feed"}),e.jsx("p",{className:"text-gray-600",children:"Stay updated with the creators you follow and their latest achievements"})]})}function I({activity:s,onFormatTime:a}){var n;const t=c=>{switch(c){case"task_completion":return e.jsx(Y,{className:"h-4 w-4 text-yellow-500"});case"streak_milestone":return e.jsx(g,{className:"h-4 w-4 text-orange-500"});case"level_up":return e.jsx(v,{className:"h-4 w-4 text-purple-500"});default:return e.jsx(v,{className:"h-4 w-4 text-gray-500"})}},r=c=>{switch(c.activity_type){case"task_completion":return`completed "${c.activity_data.task_name}" and earned ${c.activity_data.points_earned} points!`;case"streak_milestone":return`reached a ${c.activity_data.streak_days}-day streak!`;case"level_up":return`leveled up to level ${c.activity_data.new_level}!`;default:return"had some activity"}};return e.jsx(h,{className:"hover:shadow-md transition-shadow",children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs(y,{className:"h-10 w-10",children:[e.jsx(b,{src:s.user_avatar,alt:s.user_name}),e.jsx(k,{children:((n=s.user_name[0])==null?void 0:n.toUpperCase())||"?"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t(s.activity_type),e.jsx("span",{className:"font-semibold text-sm",children:s.user_name}),s.user_username&&e.jsxs("span",{className:"text-xs text-gray-500",children:["@",s.user_username]}),e.jsx("span",{className:"text-xs text-gray-500",children:"•"}),e.jsx("span",{className:"text-xs text-gray-500",children:a(s.created_at)})]}),e.jsx("p",{className:"text-sm text-gray-700 mb-2",children:r(s)}),e.jsx("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:e.jsxs("button",{className:"flex items-center gap-1 hover:text-red-500 transition-colors",children:[e.jsx(M,{className:"h-3 w-3"}),e.jsx("span",{children:"Like"})]})})]})]})})})}function J({creators:s}){const a=F();return e.jsxs(h,{children:[e.jsx(C,{children:e.jsxs(A,{className:"text-lg flex items-center gap-2",children:[e.jsx(E,{className:"h-5 w-5"}),"Following (",s.length,")"]})}),e.jsx(u,{className:"space-y-3",children:s.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"You're not following anyone yet"}),e.jsx(L,{size:"sm",onClick:()=>a("/creator-connect"),className:"bg-chichi-orange hover:bg-chichi-orange-dark",children:"Find Creators"})]}):s.map(t=>{var r,n;return e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50",children:[e.jsxs(y,{className:"h-8 w-8",children:[e.jsx(b,{src:t.avatar_url||"",alt:t.name||""}),e.jsx(k,{children:((n=(r=t.name)==null?void 0:r[0])==null?void 0:n.toUpperCase())||"?"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:t.name||`@${t.username}`}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(g,{className:"h-3 w-3 text-orange-500"}),t.current_streak]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Lvl ",t.level]})]})]})]},t.id)})})]})}function R({followingCount:s}){const{user:a}=S();return e.jsxs(h,{children:[e.jsx(C,{children:e.jsx(A,{className:"text-lg",children:"Your Stats"})}),e.jsxs(u,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Following"}),e.jsx("span",{className:"font-semibold",children:s})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Your Streak"}),e.jsxs("span",{className:"font-semibold flex items-center gap-1",children:[e.jsx(g,{className:"h-3 w-3 text-orange-500"}),(a==null?void 0:a.currentStreak)||0]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Your Level"}),e.jsx("span",{className:"font-semibold",children:(a==null?void 0:a.level)||1})]})]})]})}function G({hasFollowedCreators:s}){const a=F();return e.jsx(h,{className:"text-center py-12",children:e.jsxs(u,{children:[e.jsx(E,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No activity yet"}),e.jsx("p",{className:"text-gray-600 mb-4",children:s?"The creators you follow haven't been active recently. Check back later!":"Start following creators to see their activity here!"}),e.jsx(L,{onClick:()=>a("/creator-connect"),className:"bg-chichi-orange hover:bg-chichi-orange-dark",children:"Discover Creators"})]})})}function K(){return e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-chichi-orange mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading your feed..."})]})})}function Q(){const{user:s}=S(),{feedActivities:a,followedCreators:t,isLoading:r}=B(s==null?void 0:s.id);return r?e.jsx(K,{}):e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsx(z,{}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-4",children:a.length===0?e.jsx(G,{hasFollowedCreators:t.length>0}):a.map(n=>e.jsx(I,{activity:n,onFormatTime:q},n.id))}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(J,{creators:t}),e.jsx(R,{followingCount:t.length})]})]})]})}export{Q as default};
