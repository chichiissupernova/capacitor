import{r as t,j as e,I as L,B as g,s as P,q as p,a as N,a2 as U,a4 as I,E as v,C as q,c as T,d as B,e as A,f as H,g as M}from"./index-Caw7KGCA.js";import{z as k,t as O,C as _}from"./passwordValidator-GZWggTWZ.js";import{u as D,F as V,a as Y,b as z,c as W,d as X,e as $}from"./form-CcKQMLHU.js";import{A as G,a as J}from"./alert-D_V2V2Ts.js";import{C as K}from"./circle-check-big-BCGySWHe.js";import{P as Q,U as Z}from"./PasswordUpdateSuccess-B5OtE0Jr.js";const ee=k.object({email:k.string().trim().email({message:"Please enter a valid email address"})}),se=({onSuccess:o})=>{const[i,c]=t.useState(!1),[x,a]=t.useState(null),m=D({resolver:O(ee),defaultValues:{email:""}}),f=async s=>{a(null),c(!0);try{console.log("Requesting password reset for:",s.email);const r=`${window.location.origin}/reset-password`;console.log("Using redirect URL:",r);const{error:l}=await P.auth.resetPasswordForEmail(s.email,{redirectTo:r});if(l)throw console.error("Password reset error:",l),l;console.log("Password reset email sent successfully"),o(),p({title:"Password reset email sent",description:"Check your email for a link to reset your password."})}catch(n){console.error("Password reset error:",n);const r=n instanceof Error?n.message:"An error occurred. Please try again.";a(r),p({title:"Password reset failed",description:r,variant:"destructive"})}finally{c(!1)}};return e.jsx(V,{...m,children:e.jsxs("form",{onSubmit:m.handleSubmit(f),className:"space-y-4",children:[x&&e.jsxs(G,{variant:"destructive",className:"mb-4",children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),e.jsx(J,{children:x})]}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Enter your email address and we'll send you a link to reset your password."}),e.jsx(Y,{control:m.control,name:"email",render:({field:s})=>e.jsxs(z,{children:[e.jsx(W,{children:"Email"}),e.jsx(X,{children:e.jsx(L,{placeholder:"you@example.com",...s})}),e.jsx($,{})]})}),e.jsx(g,{type:"submit",className:"w-full bg-chichi-orange hover:bg-chichi-orange/90",disabled:i,children:i?"Sending...":"Reset Password"})]})})},re=()=>e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(K,{className:"h-12 w-12 text-green-500"})}),e.jsx("h3",{className:"text-lg font-medium",children:"Check your email"}),e.jsx("p",{className:"text-muted-foreground",children:"We've sent a password reset link to your email address."})]}),te=()=>{const o=N(),i=()=>{o("/reset-password",{replace:!0})};return e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(U,{className:"h-12 w-12 text-amber-500"})}),e.jsx("h3",{className:"text-lg font-medium",children:"Password Reset Link Expired"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Your password reset link has expired or is invalid. Please request a new link to reset your password."}),e.jsx(g,{onClick:i,className:"w-full bg-chichi-orange hover:bg-chichi-orange/90",children:"Request New Link"})]})},ue=()=>{const[o,i]=t.useState(!1),[c,x]=t.useState(!1),[a,m]=t.useState(!1),[f,s]=t.useState(!1),[n,r]=t.useState(!0),l=N(),[d]=I();t.useEffect(()=>{console.log("ResetPassword component mounted"),console.log("Current URL:",window.location.href),console.log("Search params:",Object.fromEntries(d.entries())),(async()=>{try{console.log("ResetPassword: Checking URL params and session");const u=d.get("token"),h=d.get("type"),w=d.get("error"),j=d.get("error_code");if(console.log("URL params:",{tokenHash:!!u,type:h,error:w,errorCode:j}),w==="access_denied"||j==="otp_expired"){console.log("Password reset link is expired or invalid"),s(!0),r(!1);return}if(h==="recovery"&&u){console.log("Verifying password reset token");const{data:F,error:y}=await P.auth.verifyOtp({token_hash:u,type:"recovery"});y?(console.error("Error verifying password reset token:",y),s(!0),p({title:"Invalid reset link",description:"This password reset link is invalid or expired. Please request a new one.",variant:"destructive"})):F.session?(console.log("Password reset token verified successfully, switching to update mode"),x(!0)):(console.log("Token verified but no session created"),s(!0))}else h==="recovery"&&!u?(console.log("Recovery type but no token found"),s(!0)):console.log("No recovery parameters found, showing request form")}catch(u){console.error("Error in password reset flow:",u),s(!0),p({title:"Reset link error",description:"There was an error processing your reset link. Please request a new one.",variant:"destructive"})}finally{r(!1)}})()},[d]);const b=()=>{l("/login",{replace:!0})},C=()=>{console.log("Password reset email sent successfully, showing confirmation"),i(!0)},R=()=>{m(!0),p({title:"Password updated",description:"Your password has been updated successfully. Redirecting to login..."}),setTimeout(()=>{l("/login",{replace:!0})},3e3)};if(console.log("ResetPassword render state:",{isLoading:n,isLinkExpired:f,isPasswordUpdated:a,isUpdateMode:c,isSuccess:o}),n)return e.jsx(v,{children:e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-[#FFEFE9] to-[#fffdf9]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-chichi-orange mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Processing reset link..."})]})})});const E=()=>f?"Link Expired":a?"Password Updated":c?"Update your password":o?"Check your email":"Reset your password",S=()=>f?e.jsx(te,{}):a?e.jsx(Q,{}):c?e.jsx(Z,{onSuccess:R}):o?e.jsx(re,{}):e.jsx(se,{onSuccess:C});return e.jsx(v,{children:e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-[#FFEFE9] to-[#fffdf9]",children:e.jsxs(q,{className:"w-full max-w-md shadow-lg",children:[e.jsxs(T,{className:"space-y-1 text-center px-4 sm:px-6",children:[e.jsx(B,{className:"text-2xl sm:text-3xl font-bold",children:e.jsx("span",{className:"text-chichi-orange",children:"CHICHI"})}),e.jsx(A,{children:E()})]}),e.jsx(H,{className:"px-4 sm:px-6",children:S()}),!a&&e.jsx(M,{className:"flex flex-col space-y-4 px-4 sm:px-6",children:e.jsx(g,{variant:"link",className:"w-full text-sm sm:text-base",onClick:b,children:"Back to Login"})})]})})})};export{ue as default};
