import{ar as T,j as e,I as $,S as B,x as U,y as M,z as q,A as w,ag as R,r as g,s as f,u as S,as as A,at as j,ah as E,ai as F,aj as L,G as H,an as k,B as I,au as W,av as G,aw as O,ax as z,ay as P,R as V,C as Y,f as Q}from"./index-Caw7KGCA.js";import{T as J,a as K,b as _,c as C}from"./tabs-DY4CNjxr.js";import{S as X}from"./search-ieVePH5C.js";import{u as Z,a as ee,C as se}from"./useFollowActions-Xl1zwE1B.js";import{U as te}from"./users-Bala6d7Y.js";import"./UserProfileActions-ChRHtiKK.js";const ae=["Beauty","Fashion","Wellness","Tech","Education","Lifestyle","Finance","Fitness","Music","Art & Design","Food & Recipes","Creator Education","Motivation & Mindset","Parenting","Business Owner","Other"];function re({searchQuery:s,onSearchChange:l,selectedNiche:o,onNicheChange:u}){return T(),e.jsxs("div",{className:"mb-6 md:mb-8",children:[e.jsx("div",{className:"flex items-start justify-between mb-4 gap-3",children:e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("h1",{className:"text-2xl md:text-3xl font-bold leading-tight",children:"Creator Connect"})})}),e.jsx("p",{className:"text-gray-600 mb-4 md:mb-6 text-sm md:text-base leading-relaxed",children:"Connect with creators who show up. Stay inspired by the ones building momentum—just like you."}),e.jsxs("div",{className:"space-y-3 md:space-y-0 md:flex md:gap-4 md:items-end",children:[e.jsxs("div",{className:"relative flex-1 max-w-full md:max-w-md",children:[e.jsx(X,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx($,{placeholder:"Search creators...",value:s,onChange:r=>l(r.target.value),className:"pl-10 h-12 md:h-10 text-base md:text-sm touch-manipulation"})]}),e.jsx("div",{className:"w-full md:w-48",children:e.jsxs(B,{value:o,onValueChange:u,children:[e.jsx(U,{className:"w-full h-12 md:h-10 text-base md:text-sm touch-manipulation",children:e.jsx(M,{placeholder:"Filter by niche..."})}),e.jsxs(q,{className:"bg-white border border-gray-200 shadow-lg z-50 max-h-60 overflow-y-auto",children:[e.jsx(w,{value:"all",children:"All Niches"}),ae.map(r=>e.jsx(w,{value:r,className:"py-3 text-base md:text-sm",children:r},r))]})]})})]})]})}function ce(){const{toast:s}=R(),[l,o]=g.useState([]),[u,r]=g.useState(!0),c=g.useCallback(async()=>{try{console.log("Fetching feed activities..."),r(!0);const{data:m,error:x}=await f.from("creator_feed_with_profiles").select("*").eq("is_public",!0).order("created_at",{ascending:!1}).limit(50);if(x)throw console.error("Error fetching activities:",x),x;console.log("Raw activities data from creator_feed_with_profiles:",m),console.log("Fetched activities count:",(m==null?void 0:m.length)||0);const t=(m||[]).map(n=>({...n,activity_type:n.activity_type,data:n.data}));console.log("Processed activities:",t),o(t)}catch(m){console.error("Error fetching feed activities:",m),s({title:"Error",description:"Failed to load creator feed",variant:"destructive"})}finally{r(!1)}},[s]),d=g.useCallback(async(m,x,t,n)=>{const{data:{user:i},error:a}=await f.auth.getUser();if(a||!i){console.error("No authenticated user for creating activity");return}try{console.log("Creating new activity:",{activityType:m,title:x,description:t,data:n});const{data:p,error:h}=await f.from("creator_feed_activities").insert({user_id:i.id,activity_type:m,title:x,description:t,data:n||{},is_public:!0}).select().single();if(h)throw console.error("Error creating activity:",h),h;console.log("Activity created successfully:",p),c()}catch(p){console.error("Error creating activity:",p)}},[c]);return g.useEffect(()=>{c()},[c]),{activities:l,isLoading:u,fetchActivities:c,createActivity:d}}function ne(){const{user:s}=S(),{toast:l}=R(),[o,u]=g.useState({}),[r,c]=g.useState({}),d=g.useCallback(async()=>{try{const{data:t,error:n}=await f.from("feed_reactions").select("*").order("created_at",{ascending:!1});if(n)throw n;const i={},a={};(t||[]).map(h=>({...h,reaction_type:h.reaction_type})).forEach(h=>{i[h.activity_id]||(i[h.activity_id]=[]),i[h.activity_id].push(h),s&&h.user_id===s.id&&(a[h.activity_id]||(a[h.activity_id]=new Set),a[h.activity_id].add(h.reaction_type))}),u(i),c(a)}catch(t){console.error("Error fetching reactions:",t)}},[s]),m=g.useCallback(async(t,n)=>{if(s)try{const{error:i}=await f.from("feed_reactions").insert({activity_id:t,user_id:s.id,reaction_type:n});if(i)throw i;c(a=>({...a,[t]:new Set([...a[t]||[],n])})),d()}catch(i){console.error("Error adding reaction:",i),l({title:"Error",description:"Failed to add reaction",variant:"destructive"})}},[s,d,l]),x=g.useCallback(async(t,n)=>{if(s)try{const{error:i}=await f.from("feed_reactions").delete().eq("activity_id",t).eq("user_id",s.id).eq("reaction_type",n);if(i)throw i;c(a=>{const p=new Set(a[t]||[]);return p.delete(n),{...a,[t]:p}}),d()}catch(i){console.error("Error removing reaction:",i),l({title:"Error",description:"Failed to remove reaction",variant:"destructive"})}},[s,d,l]);return{reactions:o,userReactions:r,fetchReactions:d,addReaction:m,removeReaction:x}}function ie({onActivitiesChange:s,onReactionsChange:l}){const{user:o}=S();g.useEffect(()=>{const u=f.channel("creator_feed_activities").on("postgres_changes",{event:"*",schema:"public",table:"creator_feed_activities",filter:"is_public=eq.true"},()=>{s()}).subscribe(),r=f.channel("feed_reactions").on("postgres_changes",{event:"*",schema:"public",table:"feed_reactions"},()=>{l()}).subscribe(),c=f.channel("wins_updates").on("postgres_changes",{event:"*",schema:"public",table:"wins",filter:"share_to_community=eq.true"},()=>{s()}).subscribe();return()=>{f.removeChannel(u),f.removeChannel(r),f.removeChannel(c)}},[o,s,l])}function oe(){const{activities:s,isLoading:l,fetchActivities:o,createActivity:u}=ce(),{reactions:r,userReactions:c,fetchReactions:d,addReaction:m,removeReaction:x}=ne();return g.useEffect(()=>{console.log("useCreatorFeed: Loading activities and reactions..."),o(),d()},[o,d]),ie({onActivitiesChange:o,onReactionsChange:d}),{activities:s,reactions:r,userReactions:c,isLoading:l,addReaction:m,removeReaction:x,createActivity:u,refetch:()=>{o(),d()}}}const le={Instagram:W,TikTok:G,YouTube:O,Other:A},de={big:"🔥",inspired:"💡",goal:"🎯"},me={big:"That's Big",inspired:"Inspired Me",goal:"Goal Energy"};function he({win:s,onReaction:l}){const o=le[s.platform]||A,u=async r=>{await l(s.id,r)};return e.jsxs("div",{className:"bg-white border border-gray-100 rounded-lg p-4 transition-all duration-200 hover:shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(j,{to:`/u/${s.username}`,children:e.jsxs(E,{className:"h-10 w-10 hover:opacity-80 transition-opacity",children:[e.jsx(F,{src:s.avatar_url||void 0}),e.jsx(L,{className:"bg-chichi-purple text-white text-sm",children:(s.user_name||s.username||"U").charAt(0).toUpperCase()})]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx(j,{to:`/u/${s.username}`,className:"font-medium text-sm text-gray-900 hover:text-chichi-purple transition-colors",children:s.user_name||s.username}),e.jsx("span",{className:"text-lg",children:"🏆"}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(s.created_at).toLocaleDateString()})]}),s.username&&s.user_name&&e.jsxs("p",{className:"text-xs text-gray-500",children:["@",s.username]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:s.title}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(H,{className:"h-3 w-3"}),new Date(s.date).toLocaleDateString()]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(o,{className:"h-3 w-3"}),s.platform]})]})]}),s.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mb-3",children:s.tags.map((r,c)=>e.jsx(k,{variant:"outline",className:"text-xs",children:r},c))}),s.screenshot_url&&e.jsx("div",{className:"mb-3",children:e.jsx("img",{src:s.screenshot_url,alt:"Win screenshot",className:"w-full max-h-48 object-cover rounded-md"})}),s.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:s.description}),e.jsx("div",{className:"flex items-center space-x-2 pt-2 border-t",children:Object.entries(de).map(([r,c])=>{const d=s[`${r}_reactions`];return e.jsxs(I,{variant:"ghost",size:"sm",onClick:()=>u(r),className:"h-7 px-2 text-xs transition-all duration-200 hover:bg-gray-50 text-gray-600",children:[e.jsx("span",{className:"mr-1",children:c}),e.jsx("span",{className:"hidden sm:inline",children:me[r]}),d>0&&e.jsxs("span",{className:"ml-1",children:["(",d,")"]})]},r)})})]})}const ue=s=>{switch(s){case"win":return"🏆";case"milestone":return"🎯";case"streak":return"🔥";case"badge_unlock":return"🏅";case"connection":return"🤝";case"task_completion":return"✅";case"content_progress":return"🎬";default:return"✨"}},xe=s=>{switch(s){case"win":return"text-yellow-600";case"milestone":return"text-chichi-purple";case"streak":return"text-orange-500";case"badge_unlock":return"text-blue-600";case"connection":return"text-green-600";case"task_completion":return"text-emerald-600";case"content_progress":return"text-purple-600";default:return"text-gray-600"}},ge={big:"🔥",inspired:"💡",goal:"🎯"},pe={big:"That's Big",inspired:"Inspired Me",goal:"Goal Energy"};function fe({activity:s,reactions:l,userReactions:o,onReaction:u,onRemoveReaction:r}){const c=s.user_name||s.username||"Creator",d=z(new Date(s.created_at),{addSuffix:!0}),m=l.reduce((t,n)=>(t[n.reaction_type]=(t[n.reaction_type]||0)+1,t),{}),x=t=>{o.has(t)?r(s.id,t):u(s.id,t)};return e.jsxs("div",{className:"bg-white border border-gray-100 rounded-lg p-4 mb-3 transition-all duration-200 hover:shadow-sm",children:[e.jsxs("div",{className:"flex items-start space-x-3 mb-3",children:[e.jsx(j,{to:`/u/${s.username}`,children:e.jsxs(E,{className:"h-10 w-10 hover:opacity-80 transition-opacity",children:[e.jsx(F,{src:s.avatar_url||"",alt:c}),e.jsx(L,{className:"bg-gray-100 text-gray-600",children:c.charAt(0).toUpperCase()})]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx(j,{to:`/u/${s.username}`,className:"font-medium text-sm text-gray-900 hover:text-chichi-purple transition-colors",children:c}),e.jsx("span",{className:`text-lg ${xe(s.activity_type)}`,children:ue(s.activity_type)}),e.jsx("span",{className:"text-xs text-gray-500",children:d})]}),s.niche_preferences&&s.niche_preferences.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:s.niche_preferences.slice(0,2).map(t=>e.jsx(k,{variant:"secondary",className:"text-xs px-2 py-0",children:t},t))})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-sm text-gray-900 mb-1",children:s.title}),s.description&&e.jsx("p",{className:"text-xs text-gray-600",children:s.description})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{className:"flex items-center space-x-2",children:["big","inspired","goal"].map(t=>{const n=m[t]||0,i=o.has(t);return e.jsxs(I,{variant:"ghost",size:"sm",onClick:()=>x(t),className:`h-7 px-2 text-xs transition-all duration-200 ${i?"bg-chichi-purple-soft text-chichi-purple border border-chichi-purple/20":"hover:bg-gray-50 text-gray-600"}`,children:[e.jsx("span",{className:"mr-1",children:ge[t]}),e.jsx("span",{className:"hidden sm:inline",children:pe[t]}),n>0&&e.jsx("span",{className:"ml-1 text-xs font-medium",children:n})]},t)})})})]})}function ve(){const{communityWins:s,isLoading:l,fetchCommunityWins:o,addReaction:u}=P(),{activities:r,reactions:c,userReactions:d,isLoading:m,addReaction:x,removeReaction:t}=oe();V.useEffect(()=>{console.log("CreatorFeed: Loading community wins..."),o()},[o]);const n=l||m;if(console.log("CreatorFeed render:",{winsLoading:l,activitiesLoading:m,communityWinsCount:s.length,activitiesCount:r.length}),n)return e.jsx("div",{className:"space-y-3",children:[...Array(3)].map((a,p)=>e.jsx("div",{className:"bg-white border border-gray-100 rounded-lg p-4 animate-pulse",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-3/4"})]})]})},p))});const i=[...s.map(a=>({type:"win",data:a,created_at:a.created_at})),...r.map(a=>({type:"activity",data:a,created_at:a.created_at}))].sort((a,p)=>new Date(p.created_at).getTime()-new Date(a.created_at).getTime());return console.log("CreatorFeed: Combined items count:",i.length),i.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-4xl mb-4",children:"🏆"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Activity Yet"}),e.jsx("p",{className:"text-sm text-gray-600 max-w-md mx-auto",children:"As creators on CHICHI complete tasks, log wins, and make progress, they'll appear here. Be the first to share your journey!"})]}):e.jsx("div",{className:"space-y-4",children:i.map((a,p)=>a.type==="win"?e.jsx(he,{win:a.data,onReaction:u},`win-${a.data.id}`):e.jsx(fe,{activity:a.data,reactions:c[a.data.id]||[],userReactions:d[a.data.id]||new Set,onReaction:x,onRemoveReaction:t},`activity-${a.data.id}`))})}function je(){return e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"#winwall"}),e.jsx("p",{className:"text-sm text-gray-600",children:"See what creators are achieving in real-time. Get inspired by the community's wins, milestones, and connections."})]})}function be({searchQuery:s}){return e.jsx(Y,{className:"text-center py-12",children:e.jsxs(Q,{children:[e.jsx(te,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),s?e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No creators found"}),e.jsx("p",{className:"text-gray-600",children:"Try adjusting your search terms."})]}):e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No creators yet"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Be the first to complete your profile and start connecting with other creators!"})]})]})})}function Se(){const[s,l]=g.useState(""),[o,u]=g.useState("all"),[r,c]=g.useState("feed"),{creators:d,setCreators:m,isLoading:x}=Z(),{followingStatus:t,pendingRequests:n,followingActions:i,handleFollow:a,handleUnfollow:p}=ee(d,m),h=d.filter(v=>{var y,N;const b=!s||((y=v.name)==null?void 0:y.toLowerCase().includes(s.toLowerCase()))||((N=v.username)==null?void 0:N.toLowerCase().includes(s.toLowerCase())),D=o==="all"||v.niche_preferences&&v.niche_preferences.includes(o);return b&&D});return e.jsxs("div",{className:"max-w-6xl mx-auto p-3 md:p-6",children:[e.jsx(re,{searchQuery:s,onSearchChange:l,selectedNiche:o,onNicheChange:u}),e.jsxs(J,{value:r,onValueChange:c,className:"mt-6",children:[e.jsxs(K,{className:"grid w-full grid-cols-2",children:[e.jsx(_,{value:"feed",children:"#winwall"}),e.jsx(_,{value:"discover",children:"Discover"})]}),e.jsxs(C,{value:"feed",className:"mt-6",children:[e.jsx(je,{}),e.jsx(ve,{})]}),e.jsxs(C,{value:"discover",className:"mt-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Discover Creators"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Connect with creators who are building their content journey on CHICHI."})]}),x?e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:[...Array(8)].map((v,b)=>e.jsxs("div",{className:"bg-white border border-gray-100 rounded-lg p-4 animate-pulse",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-2/3"})]})]}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded"})]})]},b))}):h.length>0?e.jsx(se,{creators:h,followingStatus:t,pendingRequests:n,followingActions:i,onFollow:a,onUnfollow:p}):e.jsx(be,{searchQuery:s})]})]})]})}export{Se as default};
