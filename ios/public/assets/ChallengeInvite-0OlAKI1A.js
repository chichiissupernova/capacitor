import{a4 as w,a as k,u as T,ag as A,r as o,j as e,C as i,f as r,ao as h,B as t,c as I,d as L,ah as S,ai as _,aj as U,G as F}from"./index-Caw7KGCA.js";import{u as B,c as E}from"./useChallenges-MXcyjD6y.js";import{U as f}from"./users-Bala6d7Y.js";function P(){var m,g,u,j;const[p]=w(),a=k(),{user:d}=T(),{activeChallenge:N}=B(),{toast:c}=A(),[s,v]=o.useState(null),[y,C]=o.useState(!0),l=p.get("token");if(o.useEffect(()=>{(async()=>{if(!l){console.log("No invite token in URL"),c({title:"Invalid Link",description:"This challenge link is missing the invite token.",variant:"destructive"}),a("/challenges");return}try{console.log("Fetching challenge for token:",l);const n=await E.validateChallengeToken(l);if(!n){console.log("No valid challenge found for token"),c({title:"Challenge Not Available",description:"This challenge link is invalid, has expired, or has already been joined.",variant:"destructive"}),a("/challenges");return}console.log("Valid challenge found:",n),v(n)}catch(n){console.error("Error fetching challenge:",n),c({title:"Challenge Not Found",description:"This challenge link is invalid or has expired.",variant:"destructive"}),a("/challenges")}finally{C(!1)}})()},[l,a,c]),!d)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:e.jsx(i,{className:"w-full max-w-md",children:e.jsxs(r,{className:"p-6 text-center",children:[e.jsx(h,{className:"h-12 w-12 mx-auto text-chichi-orange mb-4"}),e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Join CHICHI First"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"You need to create an account to accept this challenge invite."}),e.jsx(t,{onClick:()=>a("/login"),className:"w-full",children:"Sign Up / Login"})]})})});if(y)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-chichi-orange mx-auto mb-4"}),e.jsx("p",{children:"Loading challenge..."})]})});if(!s)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:e.jsx(i,{className:"w-full max-w-md",children:e.jsxs(r,{className:"p-6 text-center",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Challenge Not Found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"This challenge link is invalid or has expired."}),e.jsx(t,{onClick:()=>a("/challenges"),variant:"outline",children:"Go to Challenge Hub"})]})})});if(s.challenger_id===d.id)return a(`/challenge/join?token=${l}`,{replace:!0}),null;if(N)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:e.jsx(i,{className:"w-full max-w-md",children:e.jsxs(r,{className:"p-6 text-center",children:[e.jsx(f,{className:"h-12 w-12 mx-auto text-orange-500 mb-4"}),e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Already in a Challenge"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"You're already participating in an active challenge. Complete it before joining a new one!"}),e.jsx(t,{onClick:()=>a("/challenges"),className:"w-full",children:"View Current Challenge"})]})})});const x=((m=s.challenger_profile)==null?void 0:m.username)||((g=s.challenger_profile)==null?void 0:g.name)||"Someone",b=()=>{a(`/challenge/join?token=${l}`)};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:e.jsxs(i,{className:"w-full max-w-md",children:[e.jsxs(I,{className:"text-center",children:[e.jsx(h,{className:"h-16 w-16 mx-auto text-chichi-orange mb-4"}),e.jsx(L,{className:"text-2xl",children:"Creator Showdown Invite!"})]}),e.jsxs(r,{className:"space-y-6",children:[e.jsxs("div",{className:"text-center space-y-3",children:[e.jsxs(S,{className:"h-20 w-20 mx-auto",children:[e.jsx(_,{src:((u=s.challenger_profile)==null?void 0:u.avatar_url)||""}),e.jsx(U,{children:((j=x[0])==null?void 0:j.toUpperCase())||"U"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:x}),e.jsx("p",{className:"text-gray-600",children:"has invited you to a"}),e.jsxs("p",{className:"text-xl font-bold text-chichi-orange",children:[s.challenge_length,"-Day Creator Showdown!"]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"h-4 w-4 text-gray-600"}),e.jsxs("span",{className:"text-sm",children:[s.challenge_length," days of content creation"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"h-4 w-4 text-gray-600"}),e.jsx("span",{className:"text-sm",children:"Most points wins"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{className:"h-4 w-4 text-gray-600"}),e.jsx("span",{className:"text-sm",children:"Complete daily tasks to earn points"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(t,{onClick:b,className:"w-full bg-chichi-orange hover:bg-chichi-orange/90",children:"Accept Challenge"}),e.jsx(t,{onClick:()=>a("/challenges"),variant:"outline",className:"w-full",children:"Maybe Later"})]})]})]})})}export{P as default};
