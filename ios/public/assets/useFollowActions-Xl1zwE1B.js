import{p as A,j as e,ah as S,ai as U,aj as M,an as E,az as F,aA as $,G as L,r as _,s as p,D as P,h as R,i as T,k as Y,R as W,C as z,f as B,at as k,B as q,K as H,u as D,ag as G}from"./index-Caw7KGCA.js";import{U as O,b as V,a as J}from"./UserProfileActions-ChRHtiKK.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=A("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);function Q({displayName:t,username:a,avatarUrl:s,level:r}){return e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(S,{className:"h-16 w-16",children:[e.jsx(U,{src:s||void 0}),e.jsx(M,{className:"bg-chichi-purple text-white text-lg",children:t.charAt(0).toUpperCase()})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-semibold",children:t}),a&&e.jsxs("p",{className:"text-gray-600",children:["@",a]}),e.jsxs(E,{variant:"outline",className:"mt-1",children:["Level ",r||1]})]})]})}function X({points:t,currentStreak:a,followerCount:s,followingCount:r,joinedDate:h}){return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-center space-x-1 mb-1",children:[e.jsx(F,{className:"h-4 w-4 text-chichi-purple"}),e.jsx("span",{className:"font-bold",children:t||0})]}),e.jsx("p",{className:"text-xs text-gray-600",children:"Points"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-center space-x-1 mb-1",children:[e.jsx($,{className:"h-4 w-4 text-orange-500"}),e.jsx("span",{className:"font-bold",children:a||0})]}),e.jsx("p",{className:"text-xs text-gray-600",children:"Streak"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:s}),e.jsx("p",{className:"text-xs text-gray-600",children:"Followers"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:r}),e.jsx("p",{className:"text-xs text-gray-600",children:"Following"})]})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-1 text-sm text-gray-500",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsxs("span",{children:["Joined ",h]})]})]})}const Z={instagram:{name:"Instagram",icon:"📷",baseUrl:"https://www.instagram.com/"},tiktok:{name:"TikTok",icon:"🎵",baseUrl:"https://tiktok.com/@"},twitter:{name:"X (Twitter)",icon:"🐦",baseUrl:"https://twitter.com/"},pinterest:{name:"Pinterest",icon:"📌",baseUrl:"https://pinterest.com/"},youtube:{name:"YouTube",icon:"📺",baseUrl:"https://youtube.com/@"}};function I({socialLinks:t}){return!t||Object.keys(t).length===0?null:e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-3",children:"Social Media"}),e.jsx("div",{className:"space-y-2",children:Object.entries(t).map(([a,s])=>{const r=Z[a];if(!r||!s.handle)return null;const h=s.url||`${r.baseUrl}${s.handle}`;return e.jsxs("a",{href:h,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-between p-2 rounded-lg border hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{children:r.icon}),e.jsx("span",{className:"font-medium",children:r.name}),e.jsxs("span",{className:"text-gray-600",children:["@",s.handle]})]}),e.jsx(K,{className:"h-4 w-4 text-gray-400"})]},a)})})]})}function ee({isOpen:t,onClose:a,userId:s,isFollowing:r,isProcessing:h,onFollow:u,onUnfollow:c,onMessage:g}){const[n,m]=_.useState(null),[j,x]=_.useState(!1);_.useEffect(()=>{t&&s&&v()},[t,s]);const v=async()=>{x(!0);try{const{data:l,error:d}=await p.from("public_user_profiles").select("*").eq("id",s).single();if(d){console.error("Error fetching user profile:",d);return}const{data:w,error:N}=await p.from("user_social_links").select("platform, handle, url").eq("user_id",s);N&&console.error("Error fetching social links:",N);let y={};w&&w.forEach(C=>{y[C.platform]={handle:C.handle,url:C.url||""}}),m({id:l.id,name:l.name,username:l.username,avatar_url:l.avatar_url,points:l.points,current_streak:l.current_streak,longest_streak:l.longest_streak,level:l.level,joined_at:l.joined_at,follower_count:l.follower_count||0,following_count:l.following_count||0,social_links:y})}catch(l){console.error("Error fetching user profile:",l)}finally{x(!1)}},b=()=>{r?c(s):u(s)},i=()=>{if(n){const l=n.name||n.username||"Unknown Creator";g(s,l)}};if(!n&&!j)return null;const o=(n==null?void 0:n.name)||(n==null?void 0:n.username)||"Unknown Creator",f=n!=null&&n.joined_at?new Date(n.joined_at).toLocaleDateString():"Unknown";return e.jsx(P,{open:t,onOpenChange:a,children:e.jsxs(R,{className:"sm:max-w-[500px] max-h-[90vh] overflow-y-auto",children:[e.jsx(T,{children:e.jsx(Y,{children:"Creator Profile"})}),j?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-chichi-purple"})}):n&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(Q,{displayName:o,username:n.username,avatarUrl:n.avatar_url,level:n.level}),e.jsx(X,{points:n.points,currentStreak:n.current_streak,followerCount:n.follower_count,followingCount:n.following_count,joinedDate:f}),e.jsx(I,{socialLinks:n.social_links}),e.jsx(O,{isFollowing:r,isProcessing:h,onFollow:b,onMessage:i})]})]})})}function se({creator:t,isFollowing:a,isPending:s,isProcessing:r,onFollow:h,onUnfollow:u}){const[c,g]=W.useState(!1),n=t.name||t.username||"Unknown Creator",m=()=>{a?u(t.id):h(t.id)},j=(x,v)=>{g(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"hover:shadow-md transition-shadow duration-200",children:e.jsxs(B,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(k,{to:`/u/${t.username}`,children:e.jsxs(S,{className:"h-12 w-12 hover:opacity-80 transition-opacity",children:[e.jsx(U,{src:t.avatar_url||"",alt:n}),e.jsx(M,{className:"bg-chichi-purple text-white",children:n.charAt(0).toUpperCase()})]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx(k,{to:`/u/${t.username}`,className:"hover:underline",children:e.jsx("h3",{className:"font-medium text-sm truncate",children:n})}),e.jsxs(E,{variant:"outline",className:"text-xs",children:["Level ",t.level||1]})]}),t.username&&e.jsxs(k,{to:`/u/${t.username}`,className:"text-xs text-gray-600 hover:underline",children:["@",t.username]}),e.jsxs("div",{className:"flex items-center space-x-3 mt-2 text-xs text-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(F,{className:"h-3 w-3 text-chichi-purple"}),e.jsx("span",{children:t.points||0})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx($,{className:"h-3 w-3 text-orange-500"}),e.jsx("span",{children:t.current_streak||0})]}),e.jsx("div",{children:e.jsxs("span",{children:[t.follower_count," followers"]})})]}),t.niche_preferences&&t.niche_preferences.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[t.niche_preferences.slice(0,2).map(x=>e.jsx(E,{variant:"secondary",className:"text-xs",children:x},x)),t.niche_preferences.length>2&&e.jsxs(E,{variant:"secondary",className:"text-xs",children:["+",t.niche_preferences.length-2]})]})]})]}),e.jsxs("div",{className:"flex space-x-2 mt-3",children:[e.jsx(q,{onClick:m,disabled:r||s,variant:a?"outline":"default",size:"sm",className:`flex-1 text-xs ${a?"text-red-600 border-red-200 hover:bg-red-50":s?"text-orange-600 border-orange-200 bg-orange-50":"bg-chichi-purple hover:bg-chichi-purple-dark text-white"}`,children:r?e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-current"}):s?e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"h-3 w-3 mr-1"}),"Pending"]}):a?e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"h-3 w-3 mr-1"}),"Disconnect"]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-3 w-3 mr-1"}),"Connect"]})}),e.jsx(q,{asChild:!0,variant:"outline",size:"sm",className:"border-chichi-purple text-chichi-purple hover:bg-chichi-purple hover:text-white text-xs",children:e.jsx(k,{to:`/u/${t.username}`,children:"View Profile"})})]})]})}),e.jsx(ee,{isOpen:c,onClose:()=>g(!1),userId:t.id,isFollowing:a,isProcessing:r,onFollow:h,onUnfollow:u,onMessage:j})]})}function ae({creators:t,followingStatus:a,pendingRequests:s,followingActions:r,onFollow:h,onUnfollow:u}){return e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:t.map(c=>e.jsx(se,{creator:c,isFollowing:a[c.id]||!1,isPending:s[c.id]||!1,isProcessing:r.has(c.id),onFollow:h,onUnfollow:u},c.id))})}function ie(){const{user:t}=D(),[a,s]=_.useState([]),[r,h]=_.useState(!0),u=async()=>{try{const{data:c,error:g}=await p.from("user_privacy_settings").select("user_id").eq("share_progress_on_creator_connect",!1);if(g){console.error("Error fetching privacy settings:",g);return}const n=(c==null?void 0:c.map(d=>d.user_id))||[];let m=p.from("user_profiles").select(`
          id,
          name,
          username,
          avatar_url,
          points,
          current_streak,
          longest_streak,
          level,
          joined_at,
          niche_preferences
        `);n.length>0&&(m=m.not("id","in",`(${n.map(d=>`'${d}'`).join(",")})`));const{data:j,error:x}=await m.order("points",{ascending:!1});if(x){console.error("Error fetching user profiles:",x);return}const{data:v,error:b}=await p.from("user_follows").select("following_id").then(d=>{var N;if(d.error)return{data:null,error:d.error};const w={};return(N=d.data)==null||N.forEach(y=>{w[y.following_id]=(w[y.following_id]||0)+1}),{data:w,error:null}}),{data:i,error:o}=await p.from("user_follows").select("follower_id").then(d=>{var N;if(d.error)return{data:null,error:d.error};const w={};return(N=d.data)==null||N.forEach(y=>{w[y.follower_id]=(w[y.follower_id]||0)+1}),{data:w,error:null}});if(b||o){console.error("Error fetching follow counts:",b||o);return}const l=((j==null?void 0:j.map(d=>({...d,follower_count:(v==null?void 0:v[d.id])||0,following_count:(i==null?void 0:i[d.id])||0})))||[]).filter(d=>d.id!==(t==null?void 0:t.id)&&(d.name||d.username));s(l)}catch(c){console.error("Error fetching creators:",c)}finally{h(!1)}};return _.useEffect(()=>{u()},[t==null?void 0:t.id]),{creators:a,setCreators:s,isLoading:r,refetch:u}}class te{static async createNotification(a,s,r,h,u={}){try{const{error:c}=await p.rpc("create_notification",{target_user_id:a,notification_type:s,notification_title:r,notification_message:h,notification_data:u});if(c)throw c}catch(c){console.error("Error creating notification:",c)}}static async createMilestoneNotification(a,s,r){await this.createNotification(a,"milestone_unlocked","Milestone Unlocked!",`👏 You hit ${r} points! ${s}`,{milestone:s,points:r})}static async createWinReactionNotification(a,s,r,h){await this.createNotification(a,"win_reaction","New Reaction to Your Win",`${r} ${s} reacted to your win: "${h}"`,{reactor_name:s,reaction:r,win_title:h})}static async createSystemUpdateNotification(a,s){console.log("System notification would be sent:",{title:a,message:s})}static async createConnectionRequest(a,s){try{const{error:r}=await p.from("connection_requests").insert({requester_id:a,requested_id:s,status:"pending"});if(r)throw r}catch(r){throw console.error("Error creating connection request:",r),r}}}function oe(t,a){const{user:s}=D(),{toast:r}=G(),[h,u]=_.useState({}),[c,g]=_.useState({}),[n,m]=_.useState(new Set),j=async()=>{if(s!=null&&s.id)try{const{data:i,error:o}=await p.from("user_follows").select("following_id").eq("follower_id",s.id);if(o){console.error("Error fetching following status:",o);return}const f={};i==null||i.forEach(l=>{f[l.following_id]=!0}),u(f)}catch(i){console.error("Error fetching following status:",i)}},x=async()=>{if(s!=null&&s.id)try{const{data:i,error:o}=await p.from("connection_requests").select("requested_id").eq("requester_id",s.id).eq("status","pending");if(o){console.error("Error fetching pending requests:",o);return}const f={};i==null||i.forEach(l=>{f[l.requested_id]=!0}),g(f)}catch(i){console.error("Error fetching pending requests:",i)}},v=async i=>{if(!(!(s!=null&&s.id)||n.has(i))){m(o=>new Set(o).add(i));try{await te.createConnectionRequest(s.id,i),g(o=>({...o,[i]:!0})),r({title:"Connection Request Sent",description:"Your connection request has been sent!"})}catch(o){console.error("Error sending connection request:",o),r({title:"Error",description:"Failed to send connection request. Please try again.",variant:"destructive"})}finally{m(o=>{const f=new Set(o);return f.delete(i),f})}}},b=async i=>{if(!(!(s!=null&&s.id)||n.has(i))){m(o=>new Set(o).add(i));try{const{error:o}=await p.from("user_follows").delete().eq("follower_id",s.id).eq("following_id",i);if(o){console.error("Error disconnecting from creator:",o),r({title:"Error",description:"Failed to disconnect from creator. Please try again.",variant:"destructive"});return}u(f=>({...f,[i]:!1})),a(f=>f.map(l=>l.id===i?{...l,follower_count:Math.max(0,l.follower_count-1)}:l)),r({title:"Success",description:"You have disconnected from this creator."})}catch(o){console.error("Error disconnecting from creator:",o),r({title:"Error",description:"Failed to disconnect from creator. Please try again.",variant:"destructive"})}finally{m(o=>{const f=new Set(o);return f.delete(i),f})}}};return _.useEffect(()=>{s!=null&&s.id&&(j(),x())},[s==null?void 0:s.id]),{followingStatus:h,pendingRequests:c,followingActions:n,handleFollow:v,handleUnfollow:b}}export{ae as C,oe as a,ie as u};
